$schema: https://raw.githubusercontent.com/mark-hingston/opencode-workflows/main/schemas/workflow.schema.json
id: webhook-notify-yaml
name: Webhook Notification
description: Demonstrates HTTP step for sending notifications to external services
version: 1.0.0
tags:
  - http
  - notifications

inputs:
  message: string
  channel: string

steps:
  - id: get-git-info
    type: shell
    description: Get latest commit info
    command: git log -1 --format='%h - %s (%an)'

  - id: notify-slack
    type: http
    description: Send notification to Slack
    after: [get-git-info]
    method: POST
    url: "{{env.SLACK_WEBHOOK_URL}}"
    headers:
      Content-Type: application/json
    body:
      channel: "{{inputs.channel}}"
      text: "{{inputs.message}}"
      attachments:
        - color: "#36a64f"
          fields:
            - title: Latest Commit
              value: "{{steps.get-git-info.stdout}}"
              short: false

  - id: log-result
    type: agent
    description: Summarize notification result
    after: [notify-slack]
    prompt: |
      The Slack notification returned status {{steps.notify-slack.status}}.
      Summarize whether it was successful and what was sent.
