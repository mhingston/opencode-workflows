{
  "id": "code-review",
  "name": "Multi-Agent Code Review",
  "description": "Parallel expert code review with synthesis and optional auto-fix",
  "version": "1.0.0",
  "tags": ["review", "agents", "quality"],
  "inputs": {
    "file": "string"
  },
  "steps": [
    {
      "id": "read_file",
      "type": "file",
      "description": "Read the source file",
      "action": "read",
      "path": "{{inputs.file}}"
    },
    {
      "id": "security_review",
      "type": "agent",
      "description": "Security vulnerability analysis",
      "agent": "security-reviewer",
      "prompt": "Review this code for security issues:\n\n{{steps.read_file.content}}",
      "after": ["read_file"]
    },
    {
      "id": "perf_review",
      "type": "agent",
      "description": "Performance analysis",
      "agent": "performance-reviewer",
      "prompt": "Review this code for performance issues:\n\n{{steps.read_file.content}}",
      "after": ["read_file"]
    },
    {
      "id": "quality_review",
      "type": "agent",
      "description": "Code quality analysis",
      "agent": "quality-reviewer",
      "prompt": "Review this code for quality issues:\n\n{{steps.read_file.content}}",
      "after": ["read_file"]
    },
    {
      "id": "synthesize",
      "type": "agent",
      "description": "Synthesize reviews into prioritized action items",
      "agent": "tech-lead",
      "prompt": "Combine these code reviews into a prioritized report:\n\n## Security Review\n{{steps.security_review.response}}\n\n## Performance Review\n{{steps.perf_review.response}}\n\n## Quality Review\n{{steps.quality_review.response}}",
      "after": ["security_review", "perf_review", "quality_review"]
    },
    {
      "id": "approve_fixes",
      "type": "suspend",
      "description": "Human approval gate before generating fixes",
      "message": "Code review complete for {{inputs.file}}:\n\n{{steps.synthesize.response}}\n\nResume to generate auto-fix suggestions.",
      "after": ["synthesize"]
    },
    {
      "id": "generate_fixes",
      "type": "agent",
      "description": "Generate fixed code",
      "agent": "code-fixer",
      "prompt": "Fix the critical and high severity issues in this code:\n\nOriginal code:\n{{steps.read_file.content}}\n\nIssues to fix:\n{{steps.synthesize.response}}",
      "after": ["approve_fixes"]
    }
  ]
}
